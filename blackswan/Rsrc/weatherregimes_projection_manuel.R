#Computing weather regimes in a dataset (here NCEP) projecting NCEP-EOFs during a reference period (1970-2010) 
#by Pascal Yiou & Carmen Alvarez-Castro

rm(list = ls(all = TRUE))
# rm(list=ls())
ptm <- proc.time()# starting time script
library(ncdf4)
library(mclust)
library(maps)
library(fields)

# fetching the arguments
args <- commandArgs(trailingOnly = TRUE) 

rworkspace <- args[1]
Rsrc <- '/home/nils/birdhouse/flyingpigeon/flyingpigeon/Rsrc/'
infile <- '/home/nils/data/psl_NCEPgrid-merge/psl_day_HadGEM3-A-N216_historical_r1i1p1_19900101-20131230.nc' #args[3] 
varname <- 'psl'
time <- c( 19600101 , 19600102 ,19600103,19600104,19600105,19600106,19600107,19600108,19600109,19600110,19600111,19600112,19600113,19600114,19600115,19600116,19600117,19600118,19600119,19600120,19600121,19600122,19600123,19600124,19600125,19600126,19600127,19600128,19600129,19600130,19600201,19600202,19600203,19600204,19600205,19600206,19600207,19600208,19600209,19600210,19600211,19600212,19600213,19600214,19600215,19600216,19600217,19600218,19600219,19600220,19600221,19600222,19600223,19600224,19600225,19600226,19600227,19600228,19600229,19600230,19601201,19601202,19601203,19601204,19601205,19601206,19601207,19601208,19601209,19601210,19601211,19601212,19601213,19601214,19601215,19601216,19601217,19601218,19601219,19601220,19601221,19601222,19601223,19601224,19601225,19601226,19601227,19601228,19601229,19601230,19610101,19610102,19610103,19610104,19610105,19610106,19610107,19610108,19610109,19610110,19610111,19610112,19610113,19610114,19610115,19610116,19610117,19610118,19610119,19610120,19610121,19610122,19610123,19610124,19610125,19610126,19610127,19610128,19610129,19610130,19610201,19610202,19610203,19610204,19610205,19610206,19610207,19610208,19610209,19610210,19610211,19610212,19610213,19610214,19610215,19610216,19610217,19610218,19610219,19610220,19610221,19610222,19610223,19610224,19610225,19610226,19610227,19610228,19610229,19610230,19611201,19611202,19611203,19611204,19611205,19611206,19611207,19611208,19611209,19611210,19611211,19611212,19611213,19611214,19611215,19611216,19611217,19611218,19611219,19611220,19611221,19611222,19611223,19611224,19611225,19611226,19611227,19611228,19611229,19611230,19620101,19620102,19620103,19620104,19620105,19620106,19620107,19620108,19620109,19620110,19620111,19620112,19620113,19620114,19620115,19620116,19620117,19620118,19620119,19620120,19620121,19620122,19620123,19620124,19620125,19620126,19620127,19620128,19620129,19620130,19620201,19620202,19620203,19620204,19620205,19620206,19620207,19620208,19620209,19620210,19620211,19620212,19620213,19620214,19620215,19620216,19620217,19620218,19620219,19620220,19620221,19620222,19620223,19620224,19620225,19620226,19620227,19620228,19620229,19620230,19621201,19621202,19621203,19621204,19621205,19621206,19621207,19621208,19621209,19621210,19621211,19621212,19621213,19621214,19621215,19621216,19621217,19621218,19621219,19621220,19621221,19621222,19621223,19621224,19621225,19621226,19621227,19621228,19621229,19621230,19630101,19630102,19630103,19630104,19630105,19630106,19630107,19630108,19630109,19630110,19630111,19630112,19630113,19630114,19630115,19630116,19630117,19630118,19630119,19630120,19630121,19630122,19630123,19630124,19630125,19630126,19630127,19630128,19630129,19630130,19630201,19630202,19630203,19630204,19630205,19630206,19630207,19630208,19630209,19630210,19630211,19630212,19630213,19630214,19630215,19630216,19630217,19630218,19630219,19630220,19630221,19630222,19630223,19630224,19630225,19630226,19630227,19630228,19630229,19630230,19631201,19631202,19631203,19631204,19631205,19631206,19631207,19631208,19631209,19631210,19631211,19631212,19631213,19631214,19631215,19631216,19631217,19631218,19631219,19631220,19631221,19631222,19631223,19631224,19631225,19631226,19631227,19631228,19631229,19631230,19640101,19640102,19640103,19640104,19640105,19640106,19640107,19640108,19640109,19640110,19640111,19640112,19640113,19640114,19640115,19640116,19640117,19640118,19640119,19640120,19640121,19640122,19640123,19640124,19640125,19640126,19640127,19640128,19640129,19640130,19640201,19640202,19640203,19640204,19640205,19640206,19640207,19640208,19640209,19640210,19640211,19640212,19640213,19640214,19640215,19640216,19640217,19640218,19640219,19640220,19640221,19640222,19640223,19640224,19640225,19640226,19640227,19640228,19640229,19640230,19641201,19641202,19641203,19641204,19641205,19641206,19641207,19641208,19641209,19641210,19641211,19641212,19641213,19641214,19641215,19641216,19641217,19641218,19641219,19641220,19641221,19641222,19641223,19641224,19641225,19641226,19641227,19641228,19641229,19641230,19650101,19650102,19650103,19650104,19650105,19650106,19650107,19650108,19650109,19650110,19650111,19650112,19650113,19650114,19650115,19650116,19650117,19650118,19650119,19650120,19650121,19650122,19650123,19650124,19650125,19650126,19650127,19650128,19650129,19650130,19650201,19650202,19650203,19650204,19650205,19650206,19650207,19650208,19650209,19650210,19650211,19650212,19650213,19650214,19650215,19650216,19650217,19650218,19650219,19650220,19650221,19650222,19650223,19650224,19650225,19650226,19650227,19650228,19650229,19650230,19651201,19651202,19651203,19651204,19651205,19651206,19651207,19651208,19651209,19651210,19651211,19651212,19651213,19651214,19651215,19651216,19651217,19651218,19651219,19651220,19651221,19651222,19651223,19651224,19651225,19651226,19651227,19651228,19651229,19651230,19660101,19660102,19660103,19660104,19660105,19660106,19660107,19660108,19660109,19660110,19660111,19660112,19660113,19660114)

#)
#
          #19660115,19660116,19660117,19660118,19660119,19660120,19660121,19660122,19660123,19660124,19660125,19660126,19660127,19660128,19660129,19660130,19660201,19660202,19660203,19660204,19660205,19660206,19660207,19660208,19660209,19660210,19660211,19660212,19660213,19660214,19660215,19660216,19660217,19660218,19660219,19660220,19660221,19660222,19660223,19660224,19660225,19660226,19660227,19660228,19660229,19660230,19661201,19661202,19661203,19661204,19661205,19661206,19661207,19661208,19661209,19661210,19661211,19661212,19661213,19661214,19661215,19661216,19661217,19661218,19661219,19661220,19661221,19661222,19661223,19661224,19661225,19661226,19661227,19661228,19661229,19661230,19670101,19670102,19670103,19670104,19670105,19670106,19670107,19670108,19670109,19670110,19670111,19670112,19670113,19670114,19670115,19670116,19670117,19670118,19670119,19670120,19670121,19670122,19670123,19670124,19670125,19670126,19670127,19670128,19670129,19670130,19670201,19670202,19670203,19670204,19670205,19670206,19670207,19670208,19670209,19670210,19670211,19670212,19670213,19670214,19670215,19670216,19670217,19670218,19670219,19670220,19670221,19670222,19670223,19670224,19670225,19670226,19670227,19670228,19670229,19670230,19671201,19671202,19671203,19671204,19671205,19671206,19671207,19671208,19671209,19671210,19671211,19671212,19671213,19671214,19671215,19671216,19671217,19671218,19671219,19671220,19671221,19671222,19671223,19671224,19671225,19671226,19671227,19671228,19671229,19671230,19680101,19680102,19680103,19680104,19680105,19680106,19680107,19680108,19680109,19680110,19680111,19680112,19680113,19680114,19680115,19680116,19680117,19680118,19680119,19680120,19680121,19680122,19680123,19680124,19680125,19680126,19680127,19680128,19680129,19680130,19680201,19680202,19680203,19680204,19680205,19680206,19680207,19680208,19680209,19680210,19680211,19680212,19680213,19680214,19680215,19680216,19680217,19680218,19680219,19680220,19680221,19680222,19680223,19680224,19680225,19680226,19680227,19680228,19680229,19680230,19681201,19681202,19681203,19681204,19681205,19681206,19681207,19681208,19681209,19681210,19681211,19681212,19681213,19681214,19681215,19681216,19681217,19681218,19681219,19681220,19681221,19681222,19681223,19681224,19681225,19681226,19681227,19681228,19681229,19681230,19690101,19690102,19690103,19690104,19690105,19690106,19690107,19690108,19690109,19690110,19690111,19690112,19690113,19690114,19690115,19690116,19690117,19690118,19690119,19690120,19690121,19690122,19690123,19690124,19690125,19690126,19690127,19690128,19690129,19690130,19690201,19690202,19690203,19690204,19690205,19690206,19690207,19690208,19690209,19690210,19690211,19690212,19690213,19690214,19690215,19690216,19690217,19690218,19690219,19690220,19690221,19690222,19690223,19690224,19690225,19690226,19690227,19690228,19690229,19690230,19691201,19691202,19691203,19691204,19691205,19691206,19691207,19691208,19691209,19691210,19691211,19691212,19691213,19691214,19691215,19691216,19691217,19691218,19691219,19691220,19691221,19691222,19691223,19691224,19691225,19691226,19691227,19691228,19691229,19691230,19700101,19700102,19700103,19700104,19700105,19700106,19700107,19700108,19700109,19700110,19700111,19700112,19700113,19700114,19700115,19700116,19700117,19700118,19700119,19700120,19700121,19700122,19700123,19700124,19700125,19700126,19700127,19700128,19700129,19700130,19700201,19700202,19700203,19700204,19700205,19700206,19700207,19700208,19700209,19700210,19700211,19700212,19700213,19700214,19700215,19700216,19700217,19700218,19700219,19700220,19700221,19700222,19700223,19700224,19700225,19700226,19700227,19700228,19700229,19700230,19701201,19701202,19701203,19701204,19701205,19701206,19701207,19701208,19701209,19701210,19701211,19701212,19701213,19701214,19701215,19701216,19701217,19701218,19701219,19701220,19701221,19701222,19701223,19701224,19701225,19701226,19701227,19701228,19701229,19701230,19710101,19710102,19710103,19710104,19710105,19710106,19710107,19710108,19710109,19710110,19710111,19710112,19710113,19710114,19710115,19710116,19710117,19710118,19710119,19710120,19710121,19710122,19710123,19710124,19710125,19710126,19710127,19710128,19710129,19710130,19710201,19710202,19710203,19710204,19710205,19710206,19710207,19710208,19710209,19710210,19710211,19710212,19710213,19710214,19710215,19710216,19710217,19710218,19710219,19710220,19710221,19710222,19710223,19710224,19710225,19710226,19710227,19710228,19710229,19710230,19711201,19711202,19711203,19711204,19711205,19711206,19711207,19711208,19711209,19711210,19711211,19711212,19711213,19711214,19711215,19711216,19711217,19711218,19711219,19711220,19711221,19711222,19711223,19711224,19711225,19711226,19711227,19711228,19711229,19711230,19720101,19720102,19720103,19720104,19720105,19720106,19720107,19720108,19720109,19720110,19720111,19720112,19720113,19720114,19720115,19720116,19720117,19720118,19720119,19720120,19720121,19720122,19720123,19720124,19720125,19720126,19720127,19720128,19720129,19720130,19720201,19720202,19720203,19720204,19720205,19720206,19720207,19720208,19720209,19720210,19720211,19720212,19720213,19720214,19720215,19720216,19720217,19720218,19720219,19720220,
          
#19720221,19720222,19720223,19720224,19720225,19720226,19720227,19720228,19720229,19720230,19721201,19721202,19721203,19721204,19721205,19721206,19721207,19721208,19721209,19721210,19721211,19721212,19721213,19721214,19721215,19721216,19721217,19721218,19721219,19721220,19721221,19721222,19721223,19721224,19721225,19721226,19721227,19721228,19721229,19721230,19730101,19730102,19730103,19730104,19730105,19730106,19730107,19730108,19730109,19730110,19730111,19730112,19730113,19730114,19730115,19730116,19730117,19730118,19730119,19730120,19730121,19730122,19730123,19730124,19730125,19730126,19730127,19730128,19730129,19730130,19730201,19730202,19730203,19730204,19730205,19730206,19730207,19730208,19730209,19730210,19730211,19730212,19730213,19730214,19730215,19730216,19730217,19730218,19730219,19730220,19730221,19730222,19730223,19730224,19730225,19730226,19730227,19730228,19730229,19730230,19731201,19731202,19731203,19731204,19731205,19731206,19731207,19731208,19731209,19731210,19731211,19731212,19731213,19731214,19731215,19731216,19731217,19731218,19731219,19731220,19731221,19731222,19731223,19731224,19731225,19731226,19731227,19731228,19731229,19731230,19740101,19740102,19740103,19740104,19740105,19740106,19740107,19740108,19740109,19740110,19740111,19740112,19740113,19740114,19740115,19740116,19740117,19740118,19740119,19740120,19740121,19740122,19740123,19740124,19740125,19740126,19740127,19740128,19740129,19740130,19740201,19740202,19740203,19740204,19740205,19740206,19740207,19740208,19740209,19740210,19740211,19740212,19740213,19740214,19740215,19740216,19740217,19740218,19740219,19740220,19740221,19740222,19740223,19740224,19740225,19740226,19740227,19740228,19740229,19740230,19741201,19741202,19741203,19741204,19741205,19741206,19741207,19741208,19741209,19741210,19741211,19741212,19741213,19741214,19741215,19741216,19741217,19741218,19741219,19741220,19741221,19741222,19741223,19741224,19741225,19741226,19741227,19741228,19741229,19741230,19750101,19750102,19750103,19750104,19750105,19750106,19750107,19750108,19750109,19750110,19750111,19750112,19750113,19750114,19750115,19750116,19750117,19750118,19750119,19750120,19750121,19750122,19750123,19750124,19750125,19750126,19750127,19750128,19750129,19750130,19750201,19750202,19750203,19750204,19750205,19750206,19750207,19750208,19750209,19750210,19750211,19750212,19750213,19750214,19750215,19750216,19750217,19750218,19750219,19750220,19750221,19750222,19750223,19750224,19750225,19750226,19750227,19750228,19750229,19750230,19751201,19751202,19751203,19751204,19751205,19751206,19751207,19751208,19751209,19751210,19751211,19751212,19751213,19751214,19751215,19751216,19751217,19751218,19751219,19751220,19751221,19751222,19751223,19751224,19751225,19751226,19751227,19751228,19751229,19751230,19760101,19760102,19760103,19760104,19760105,19760106,19760107,19760108,19760109,19760110,19760111,19760112,19760113,19760114,19760115,19760116,19760117,19760118,19760119,19760120,19760121,19760122,19760123,19760124,19760125,19760126,19760127,19760128,19760129,19760130,19760201,19760202,19760203,19760204,19760205,19760206,19760207,19760208,19760209,19760210,19760211,19760212,19760213,19760214,19760215,19760216,19760217,19760218,19760219,19760220,19760221,19760222,19760223,19760224,19760225,19760226,19760227,19760228,19760229,19760230,19761201,19761202,19761203,19761204,19761205,19761206,19761207,19761208,19761209,19761210,19761211,19761212,19761213,19761214,19761215,19761216,19761217,19761218,19761219,19761220,19761221,19761222,19761223,19761224,19761225,19761226,19761227,19761228,19761229,19761230,19770101,19770102,19770103,19770104,19770105,19770106,19770107,19770108,19770109,19770110,19770111,19770112,19770113,19770114,19770115,19770116,19770117,19770118,19770119,19770120,19770121,19770122,19770123,19770124,19770125,19770126,19770127,19770128,19770129,19770130,19770201,19770202,19770203,19770204,19770205,19770206,19770207,19770208,19770209,19770210,19770211,19770212,19770213,19770214,19770215,19770216,19770217,19770218,19770219,19770220,19770221,19770222,19770223,19770224,19770225,19770226,19770227,19770228,19770229,19770230,19771201,19771202,19771203,19771204,19771205,19771206,19771207,19771208,19771209,19771210,19771211,19771212,19771213,19771214,19771215,19771216,19771217,19771218,19771219,19771220,19771221,19771222,19771223,19771224,19771225,19771226,19771227,19771228,19771229,19771230,19780101,19780102,19780103,19780104,19780105,19780106,19780107,19780108,19780109,19780110,19780111,19780112,19780113,19780114,19780115,19780116,19780117,19780118,19780119,19780120,19780121,19780122,19780123,19780124,19780125,19780126,19780127,19780128,19780129,19780130,19780201,19780202,19780203,19780204,19780205,19780206,19780207,19780208,19780209,19780210,19780211,19780212,19780213,19780214,19780215,19780216,19780217,19780218,19780219,19780220,19780221,19780222,19780223,19780224,19780225,19780226,19780227,19780228,19780229,19780230,19781201,19781202,19781203,19781204,19781205,
#19781206,19781207,19781208,19781209,19781210,19781211,19781212,19781213,19781214,19781215,19781216,19781217,19781218,19781219,19781220,19781221,19781222,19781223,19781224,19781225,19781226,19781227,19781228,19781229,19781230,19790101,19790102,19790103,19790104,19790105,19790106,19790107,19790108,19790109,19790110,19790111,19790112,19790113,19790114,19790115,19790116,19790117,19790118,19790119,19790120,19790121,19790122,19790123,19790124,19790125,19790126,19790127,19790128,19790129,19790130,19790201,19790202,19790203,19790204,19790205,19790206,19790207,19790208,19790209,19790210,19790211,19790212,19790213,19790214,19790215,19790216,19790217,19790218,19790219,19790220,19790221,19790222,19790223,19790224,19790225,19790226,19790227,19790228,19790229,19790230,19791201,19791202,19791203,19791204,19791205,19791206,19791207,19791208,19791209,19791210,19791211,19791212,19791213,19791214,19791215,19791216,19791217,19791218,19791219,19791220,19791221,19791222,19791223,19791224,19791225,19791226,19791227,19791228,19791229,19791230,19800101,19800102,19800103,19800104,19800105,19800106,19800107,19800108,19800109,19800110,19800111,19800112,19800113,19800114,19800115,19800116,19800117,19800118,19800119,19800120,19800121,19800122,19800123,19800124,19800125,19800126,19800127,19800128,19800129,19800130,19800201,19800202,19800203,19800204,19800205,19800206,19800207,19800208,19800209,19800210,19800211,19800212,19800213,19800214,19800215,19800216,19800217,19800218,19800219,19800220,19800221,19800222,19800223,19800224,19800225,19800226,19800227,19800228,19800229,19800230,19801201,19801202,19801203,19801204,19801205,19801206,19801207,19801208,19801209,19801210,19801211,19801212,19801213,19801214,19801215,19801216,19801217,19801218,19801219,19801220,19801221,19801222,19801223,19801224,19801225,19801226,19801227,19801228,19801229,19801230,19810101,19810102,19810103,19810104,19810105,19810106,19810107,19810108,19810109,19810110,19810111,19810112,19810113,19810114,19810115,19810116,19810117,19810118,19810119,19810120,19810121,19810122,19810123,19810124,19810125,19810126,19810127,19810128,19810129,19810130,19810201,19810202,19810203,19810204,19810205,19810206,19810207,19810208,19810209,19810210,19810211,19810212,19810213,19810214,19810215,19810216,19810217,19810218,19810219,19810220,19810221,19810222,19810223,19810224,19810225,19810226,19810227,19810228,19810229,19810230,19811201,19811202,19811203,19811204,19811205,19811206,19811207,19811208,19811209,19811210,19811211,19811212,19811213,19811214,19811215,19811216,19811217,19811218,19811219,19811220,19811221,19811222,19811223,19811224,19811225,19811226,19811227,19811228,19811229,19811230,19820101,19820102,19820103,19820104,19820105,19820106,19820107,19820108,19820109,19820110,19820111,19820112,19820113,19820114,19820115,19820116,19820117,19820118,19820119,19820120,19820121,19820122,19820123,19820124,19820125,19820126,19820127,19820128,19820129,19820130,19820201,19820202,19820203,19820204,19820205,19820206,19820207,19820208,19820209,19820210,19820211,19820212,19820213,19820214,19820215,19820216,19820217,19820218,19820219,19820220,19820221,19820222,19820223,19820224,19820225,19820226,19820227,19820228,19820229,19820230,19821201,19821202,19821203,19821204,19821205,19821206,19821207,19821208,19821209,19821210,19821211,19821212,19821213,19821214,19821215,19821216,19821217,19821218,19821219,19821220,19821221,19821222,19821223,19821224,19821225,19821226,19821227,19821228,19821229,19821230,19830101,19830102,19830103,19830104,19830105,19830106,19830107,19830108,19830109,19830110,19830111,19830112,19830113,19830114,19830115,19830116,19830117,19830118,19830119,19830120,19830121,19830122,19830123,19830124,19830125,19830126,19830127,19830128,19830129,19830130,19830201,19830202,19830203,19830204,19830205,19830206,19830207,19830208,19830209,19830210,19830211,19830212,19830213,19830214,19830215,19830216,19830217,19830218,19830219,19830220,19830221,19830222,19830223,19830224,19830225,19830226,19830227,19830228,19830229,19830230,19831201,19831202,19831203,19831204,19831205,19831206,19831207,19831208,19831209,19831210,19831211,19831212,19831213,19831214,19831215,19831216,19831217,19831218,19831219,19831220,19831221,19831222,19831223,19831224,19831225,19831226,19831227,19831228,19831229,19831230,19840101,19840102,19840103,19840104,19840105,19840106,19840107,19840108,19840109,19840110,19840111,19840112,19840113,19840114,19840115,19840116,19840117,19840118,19840119,19840120,19840121,19840122,19840123,19840124,19840125,19840126,19840127,19840128,19840129,19840130,19840201,19840202,19840203,19840204,19840205,19840206,19840207,19840208,19840209,19840210,19840211,19840212,19840213,19840214,19840215,19840216,19840217,19840218,19840219,19840220,19840221,19840222,19840223,19840224,19840225,19840226,19840227,19840228,19840229,19840230,19841201,19841202,19841203,19841204,19841205,19841206,19841207,19841208,19841209,19841210,19841211,19841212,19841213,19841214,19841215,19841216,19841217,19841218,19841219,19841220,
#19841221,19841222,19841223,19841224,19841225,19841226,19841227,19841228,19841229,19841230,19850101,19850102,19850103,19850104,19850105,19850106,19850107,19850108,19850109,19850110,19850111,19850112,19850113,19850114,19850115,19850116,19850117,19850118,19850119,19850120,19850121,19850122,19850123,19850124,19850125,19850126,19850127,19850128,19850129,19850130,19850201,19850202,19850203,19850204,19850205,19850206,19850207,19850208,19850209,19850210,19850211,19850212,19850213,19850214,19850215,19850216,19850217,19850218,19850219,19850220,19850221,19850222,19850223,19850224,19850225,19850226,19850227,19850228,19850229,19850230,19851201,19851202,19851203,19851204,19851205,19851206,19851207,19851208,19851209,19851210,19851211,19851212,19851213,19851214,19851215,19851216,19851217,19851218,19851219,19851220,19851221,19851222,19851223,19851224,19851225,19851226,19851227,19851228,19851229,19851230,19860101,19860102,19860103,19860104,19860105,19860106,19860107,19860108,19860109,19860110,19860111,19860112,19860113,19860114,19860115,19860116,19860117,19860118,19860119,19860120,19860121,19860122,19860123,19860124,19860125,19860126,19860127,19860128,19860129,19860130,19860201,19860202,19860203,19860204,19860205,19860206,19860207,19860208,19860209,19860210,19860211,19860212,19860213,19860214,19860215,19860216,19860217,19860218,19860219,19860220,19860221,19860222,19860223,19860224,19860225,19860226,19860227,19860228,19860229,19860230,19861201,19861202,19861203,19861204,19861205,19861206,19861207,19861208,19861209,19861210,19861211,19861212,19861213,19861214,19861215,19861216,19861217,19861218,19861219,19861220,19861221,19861222,19861223,19861224,19861225,19861226,19861227,19861228,19861229,19861230,19870101,19870102,19870103,19870104,19870105,19870106,19870107,19870108,19870109,19870110,19870111,19870112,19870113,19870114,19870115,19870116,19870117,19870118,19870119,19870120,19870121,19870122,19870123,19870124,19870125,19870126,19870127,19870128,19870129,19870130,19870201,19870202,19870203,19870204,19870205,19870206,19870207,19870208,19870209,19870210,19870211,19870212,19870213,19870214,19870215,19870216,19870217,19870218,19870219,19870220,19870221,19870222,19870223,19870224,19870225,19870226,19870227,19870228,19870229,19870230,19871201,19871202,19871203,19871204,19871205,19871206,19871207,19871208,19871209,19871210,19871211,19871212,19871213,19871214,19871215,19871216,19871217,19871218,19871219,19871220,19871221,19871222,19871223,19871224,19871225,19871226,19871227,19871228,19871229,19871230,19880101,19880102,19880103,19880104,19880105,19880106,19880107,19880108,19880109,19880110,19880111,19880112,19880113,19880114,19880115,19880116,19880117,19880118,19880119,19880120,19880121,19880122,19880123,19880124,19880125,19880126,19880127,19880128,19880129,19880130,19880201,19880202,19880203,19880204,19880205,19880206,19880207,19880208,19880209,19880210,19880211,19880212,19880213,19880214,19880215,19880216,19880217,19880218,19880219,19880220,19880221,19880222,19880223,19880224,19880225,19880226,19880227,19880228,19880229,19880230,19881201,19881202,19881203,19881204,19881205,19881206,19881207,19881208,19881209,19881210,19881211,19881212,19881213,19881214,19881215,19881216,19881217,19881218,19881219,19881220,19881221,19881222,19881223,19881224,19881225,19881226,19881227,19881228,19881229,19881230,19890101,19890102,19890103,19890104,19890105,19890106,19890107,19890108,19890109,19890110,19890111,19890112,19890113,19890114,19890115,19890116,19890117,19890118,19890119,19890120,19890121,19890122,19890123,19890124,19890125,19890126,19890127,19890128,19890129,19890130,19890201,19890202,19890203,19890204,19890205,19890206,19890207,19890208,19890209,19890210,19890211,19890212,19890213,19890214,19890215,19890216,19890217,19890218,19890219,19890220,19890221,19890222,19890223,19890224,19890225,19890226,19890227,19890228,19890229,19890230,19891201,19891202,19891203,19891204,19891205,19891206,19891207,19891208,19891209,19891210,19891211,19891212,19891213,19891214,19891215,19891216,19891217,19891218,19891219,19891220,19891221,19891222,19891223,19891224,19891225,19891226,19891227,19891228,19891229,19891230,19900101,19900102,19900103,19900104,19900105,19900106,19900107,19900108,19900109,19900110,19900111,19900112,19900113,19900114,19900115,19900116,19900117,19900118,19900119,19900120,19900121,19900122,19900123,19900124,19900125,19900126,19900127,19900128,19900129,19900130,19900201,19900202,19900203,19900204,19900205,19900206,19900207,19900208,19900209,19900210,19900211,19900212,19900213,19900214,19900215,19900216,19900217,19900218,19900219,19900220,19900221,19900222,19900223,19900224,19900225,19900226,19900227,19900228,19900229,19900230,19901201,19901202,19901203,19901204,19901205,19901206,19901207,19901208,19901209,19901210,19901211,19901212,19901213,19901214,19901215,19901216,19901217,19901218,19901219,19901220,19901221,19901222,19901223,19901224,19901225,19901226,19901227,19901228,19901229,19901230,19910101,19910102,19910103,19910104,19910105,
#19910106,19910107,19910108,19910109,19910110,19910111,19910112,19910113,19910114,19910115,19910116,19910117,19910118,19910119,19910120,19910121,19910122,19910123,19910124,19910125,19910126,19910127,19910128,19910129,19910130,19910201,19910202,19910203,19910204,19910205,19910206,19910207,19910208,19910209,19910210,19910211,19910212,19910213,19910214,19910215,19910216,19910217,19910218,19910219,19910220,19910221,19910222,19910223,19910224,19910225,19910226,19910227,19910228,19910229,19910230,19911201,19911202,19911203,19911204,19911205,19911206,19911207,19911208,19911209,19911210,19911211,19911212,19911213,19911214,19911215,19911216,19911217,19911218,19911219,19911220,19911221,19911222,19911223,19911224,19911225,19911226,19911227,19911228,19911229,19911230,19920101,19920102,19920103,19920104,19920105,19920106,19920107,19920108,19920109,19920110,19920111,19920112,19920113,19920114,19920115,19920116,19920117,19920118,19920119,19920120,19920121,19920122,19920123,19920124,19920125,19920126,19920127,19920128,19920129,19920130,19920201,19920202,19920203,19920204,19920205,19920206,19920207,19920208,19920209,19920210,19920211,19920212,19920213,19920214,19920215,19920216,19920217,19920218,19920219,19920220,19920221,19920222,19920223,19920224,19920225,19920226,19920227,19920228,19920229,19920230,19921201,19921202,19921203,19921204,19921205,19921206,19921207,19921208,19921209,19921210,19921211,19921212,19921213,19921214,19921215,19921216,19921217,19921218,19921219,19921220,19921221,19921222,19921223,19921224,19921225,19921226,19921227,19921228,19921229,19921230,19930101,19930102,19930103,19930104,19930105,19930106,19930107,19930108,19930109,19930110,19930111,19930112,19930113,19930114,19930115,19930116,19930117,19930118,19930119,19930120,19930121,19930122,19930123,19930124,19930125,19930126,19930127,19930128,19930129,19930130,19930201,19930202,19930203,19930204,19930205,19930206,19930207,19930208,19930209,19930210,19930211,19930212,19930213,19930214,19930215,19930216,19930217,19930218,19930219,19930220,19930221,19930222,19930223,19930224,19930225,19930226,19930227,19930228,19930229,19930230,19931201,19931202,19931203,19931204,19931205,19931206,19931207,19931208,19931209,19931210,19931211,19931212,19931213,19931214,19931215,19931216,19931217,19931218,19931219,19931220,19931221,19931222,19931223,19931224,19931225,19931226,19931227,19931228,19931229,19931230,19940101,19940102,19940103,19940104,19940105,19940106,19940107,19940108,19940109,19940110,19940111,19940112,19940113,19940114,19940115,19940116,19940117,19940118,19940119,19940120,19940121,19940122,19940123,19940124,19940125,19940126,19940127,19940128,19940129,19940130,19940201,19940202,19940203,19940204,19940205,19940206,19940207,19940208,19940209,19940210,19940211,19940212,19940213,19940214,19940215,19940216,19940217,19940218,19940219,19940220,19940221,19940222,19940223,19940224,19940225,19940226,19940227,19940228,19940229,19940230,19941201,19941202,19941203,19941204,19941205,19941206,19941207,19941208,19941209,19941210,19941211,19941212,19941213,19941214,19941215,19941216,19941217,19941218,19941219,19941220,19941221,19941222,19941223,19941224,19941225,19941226,19941227,19941228,19941229,19941230,19950101,19950102,19950103,19950104,19950105,19950106,19950107,19950108,19950109,19950110,19950111,19950112,19950113,19950114,19950115,19950116,19950117,19950118,19950119,19950120,19950121,19950122,19950123,19950124,19950125,19950126,19950127,19950128,19950129,19950130,19950201,19950202,19950203,19950204,19950205,19950206,19950207,19950208,19950209,19950210,19950211,19950212,19950213,19950214,19950215,19950216,19950217,19950218,19950219,19950220,19950221,19950222,19950223,19950224,19950225,19950226,19950227,19950228,19950229,19950230,19951201,19951202,19951203,19951204,19951205,19951206,19951207,19951208,19951209,19951210,19951211,19951212,19951213,19951214,19951215,19951216,19951217,19951218,19951219,19951220,19951221,19951222,19951223,19951224,19951225,19951226,19951227,19951228,19951229,19951230,19960101,19960102,19960103,19960104,19960105,19960106,19960107,19960108,19960109,19960110,19960111,19960112,19960113,19960114,19960115,19960116,19960117,19960118,19960119,19960120,19960121,19960122,19960123,19960124,19960125,19960126,19960127,19960128,19960129,19960130,19960201,19960202,19960203,19960204,19960205,19960206,19960207,19960208,19960209,19960210,19960211,19960212,19960213,19960214,19960215,19960216,19960217,19960218,19960219,19960220,19960221,19960222,19960223,19960224,19960225,19960226,19960227,19960228,19960229,19960230,19961201,19961202,19961203,19961204,19961205,19961206,19961207,19961208,19961209,19961210,19961211,19961212,19961213,19961214,19961215,19961216,19961217,19961218,19961219,19961220,19961221,19961222,19961223,19961224,19961225,19961226,19961227,19961228,19961229,19961230,19970101,19970102,19970103,19970104,19970105,19970106,19970107,19970108,19970109,19970110,19970111,19970112,19970113,19970114,19970115,19970116,19970117,19970118,19970119,19970120)
#19970121,19970122,19970123,19970124,19970125,19970126,19970127,19970128,19970129,19970130,19970201,19970202,19970203,19970204,19970205,19970206,19970207,19970208,19970209,19970210,19970211,19970212,19970213,19970214,19970215,19970216,19970217,19970218,19970219,19970220,19970221,19970222,19970223,19970224,19970225,19970226,19970227,19970228,19970229,19970230,19971201,19971202,19971203,19971204,19971205,19971206,19971207,19971208,19971209,19971210,19971211,19971212,19971213,19971214,19971215,19971216,19971217,19971218,19971219,19971220,19971221,19971222,19971223,19971224,19971225,19971226,19971227,19971228,19971229,19971230,19980101,19980102,19980103,19980104,19980105,19980106,19980107,19980108,19980109,19980110,19980111,19980112,19980113,19980114,19980115,19980116,19980117,19980118,19980119,19980120,19980121,19980122,19980123,19980124,19980125,19980126,19980127,19980128,19980129,19980130,19980201,19980202,19980203,19980204,19980205,19980206,19980207,19980208,19980209,19980210,19980211,19980212,19980213,19980214,19980215,19980216,19980217,19980218,19980219,19980220,19980221,19980222,19980223,19980224,19980225,19980226,19980227,19980228,19980229,19980230,19981201,19981202,19981203,19981204,19981205,19981206,19981207,19981208,19981209,19981210,19981211,19981212,19981213,19981214,19981215,19981216,19981217,19981218,19981219,19981220,19981221,19981222,19981223,19981224,19981225,19981226,19981227,19981228,19981229,19981230,19990101,19990102,19990103,19990104,19990105,19990106,19990107,19990108,19990109,19990110,19990111,19990112,19990113,19990114,19990115,19990116,19990117,19990118,19990119,19990120,19990121,19990122,19990123,19990124,19990125,19990126,19990127,19990128,19990129,19990130,19990201,19990202,19990203,19990204,19990205,19990206,19990207,19990208,19990209,19990210,19990211,19990212,19990213,19990214,19990215,19990216,19990217,19990218,19990219,19990220,19990221,19990222,19990223,19990224,19990225,19990226,19990227,19990228,19990229,19990230,19991201,19991202,19991203,19991204,19991205,19991206,19991207,19991208,19991209,19991210,19991211,19991212,19991213,19991214,19991215,19991216,19991217,19991218,19991219,19991220,19991221,19991222,19991223,19991224,19991225,19991226,19991227,19991228,19991229,19991230)
#,20000101,20000102,20000103,20000104,20000105,20000106,20000107,20000108,20000109,20000110,20000111,20000112,20000113,20000114,20000115,20000116,20000117,20000118,20000119,20000120,20000121,20000122,20000123,20000124,20000125,20000126,20000127,20000128,20000129,20000130,20000201,20000202,20000203,20000204,20000205,20000206,20000207,20000208,20000209,20000210,20000211,20000212,20000213,20000214,20000215,20000216,20000217,20000218,20000219,20000220,20000221,20000222,20000223,20000224,20000225,20000226,20000227,20000228,20000229,20000230,20001201,20001202,20001203,20001204,20001205,20001206,20001207,20001208,20001209,20001210,20001211,20001212,20001213,20001214,20001215,20001216,20001217,20001218,20001219,20001220,20001221,20001222,20001223,20001224,20001225,20001226,20001227,20001228,20001229,20001230,20010101,20010102,20010103,20010104,20010105,20010106,20010107,20010108,20010109,20010110,20010111,20010112,20010113,20010114,20010115,20010116,20010117,20010118,20010119,20010120,20010121,20010122,20010123,20010124,20010125,20010126,20010127,20010128,20010129,20010130,20010201,20010202,20010203,20010204,20010205,20010206,20010207,20010208,20010209,20010210,20010211,20010212,20010213,20010214,20010215,20010216,20010217,20010218,20010219,20010220,20010221,20010222,20010223,20010224,20010225,20010226,20010227,20010228,20010229,20010230,20011201,20011202,20011203,20011204,20011205,20011206,20011207,20011208,20011209,20011210,20011211,20011212,20011213,20011214,20011215,20011216,20011217,20011218,20011219,20011220,20011221,20011222,20011223,20011224,20011225,20011226,20011227,20011228,20011229,20011230,20020101,20020102,20020103,20020104,20020105,20020106,20020107,20020108,20020109,20020110,20020111,20020112,20020113,20020114,20020115,20020116,20020117,20020118,20020119,20020120,20020121,20020122,20020123,20020124,20020125,20020126,20020127,20020128,20020129,20020130,20020201,20020202,20020203,20020204,20020205,20020206,20020207,20020208,20020209,20020210,20020211,20020212,20020213,20020214,20020215,20020216,20020217,20020218,20020219,20020220,20020221,20020222,20020223,20020224,20020225,20020226,20020227,20020228,20020229,20020230,20021201,20021202,20021203,20021204,20021205,20021206,20021207,20021208,20021209,20021210,20021211,20021212,20021213,20021214,20021215,20021216,20021217,20021218,20021219,20021220,20021221,20021222,20021223,20021224,20021225,20021226,20021227,20021228,20021229,20021230,20030101,20030102,20030103,20030104,20030105,20030106,20030107,20030108,20030109,20030110,20030111,20030112,20030113,20030114,20030115,20030116,20030117,20030118,20030119,20030120,20030121,20030122,20030123,20030124,20030125,20030126,20030127,20030128,20030129,20030130,20030201,20030202,20030203,20030204,20030205,20030206,20030207,20030208,20030209,20030210,20030211,20030212,20030213,20030214,20030215,20030216,20030217,20030218,20030219,20030220,20030221,20030222,20030223,20030224,20030225,20030226,20030227,20030228,20030229,20030230,20031201,20031202,20031203,20031204,20031205,20031206,20031207,20031208,20031209,20031210,20031211,20031212,20031213,20031214,20031215,20031216,20031217,20031218,20031219,20031220,20031221,20031222,20031223,20031224,20031225,20031226,20031227,20031228,20031229,20031230,20040101,20040102,20040103,20040104,20040105,20040106,20040107,20040108,20040109,20040110,20040111,20040112,20040113,20040114,20040115,20040116,20040117,20040118,20040119,20040120,20040121,20040122,20040123,20040124,20040125,20040126,20040127,20040128,20040129,20040130,20040201,20040202,20040203,20040204,20040205,20040206,20040207,20040208,20040209,20040210,20040211,20040212,20040213,20040214,20040215,20040216,20040217,20040218,20040219,20040220,20040221,20040222,20040223,20040224,20040225,20040226,20040227,20040228,20040229,20040230,20041201,20041202,20041203,20041204,20041205,20041206,20041207,20041208,20041209,20041210,20041211,20041212,20041213,20041214,20041215,20041216,20041217,20041218,20041219,20041220,20041221,20041222,20041223,20041224,20041225,20041226,20041227,20041228,20041229,20041230,20050101,20050102,20050103,20050104,20050105,20050106,20050107,20050108,20050109,20050110,20050111,20050112,20050113,20050114,20050115,20050116,20050117,20050118,20050119,20050120,20050121,20050122,20050123,20050124,20050125,20050126,20050127,20050128,20050129,20050130,20050201,20050202,20050203,20050204,20050205,20050206,20050207,20050208,20050209,20050210,20050211,20050212,20050213,20050214,20050215,20050216,20050217,20050218,20050219,20050220,20050221,20050222,20050223,20050224,20050225,20050226,20050227,20050228,20050229,20050230,20051201,20051202,20051203,20051204,20051205,20051206,20051207,20051208,20051209,20051210,20051211,20051212,20051213,20051214,20051215,20051216,20051217,20051218,20051219,20051220,20051221,20051222,20051223,20051224,20051225,20051226,20051227,20051228,20051229,20051230,20060101,20060102,20060103,20060104,20060105,20060106,20060107,20060108,20060109,20060110,20060111,20060112,20060113,20060114,20060115,20060116,20060117,20060118,20060119,20060120,20060121,20060122,20060123,20060124,20060125,20060126,20060127,20060128,20060129,20060130,20060201,20060202,20060203,20060204,20060205,20060206,20060207,20060208,20060209,20060210,20060211,20060212,20060213,20060214,20060215,20060216,20060217,20060218,20060219,20060220,20060221,20060222,20060223,20060224,20060225,20060226,20060227,20060228,20060229,20060230,20061201,20061202,20061203,20061204,20061205,20061206,20061207,20061208,20061209,20061210,20061211,20061212,20061213,20061214,20061215,20061216,20061217,20061218,20061219,20061220,20061221,20061222,20061223,20061224,20061225,20061226,20061227,20061228,20061229,20061230,20070101,20070102,20070103,20070104,20070105,20070106,20070107,20070108,20070109,20070110,20070111,20070112,20070113,20070114,20070115,20070116,20070117,20070118,20070119,20070120,20070121,20070122,20070123,20070124,20070125,20070126,20070127,20070128,20070129,20070130,20070201,20070202,20070203,20070204,20070205,20070206,20070207,20070208,20070209,20070210,20070211,20070212,20070213,20070214,20070215,20070216,20070217,20070218,20070219,20070220,20070221,20070222,20070223,20070224,20070225,20070226,20070227,20070228,20070229,20070230,20071201,20071202,20071203,20071204,20071205,20071206,20071207,20071208,20071209,20071210,20071211,20071212,20071213,20071214,20071215,20071216,20071217,20071218,20071219,20071220,20071221,20071222,20071223,20071224,20071225,20071226,20071227,20071228,20071229,20071230,20080101,20080102,20080103,20080104,20080105,20080106,20080107,20080108,20080109,20080110,20080111,20080112,20080113,20080114,20080115,20080116,20080117,20080118,20080119,20080120,20080121,20080122,20080123,20080124,20080125,20080126,20080127,20080128,20080129,20080130,20080201,20080202,20080203,20080204,20080205,20080206,20080207,20080208,20080209,20080210,20080211,20080212,20080213,20080214,20080215,20080216,20080217,20080218,20080219,20080220,20080221,20080222,20080223,20080224,20080225,20080226,20080227,20080228,20080229,20080230,20081201,20081202,20081203,20081204,20081205,20081206,20081207,20081208,20081209,20081210,20081211,20081212,20081213,20081214,20081215,20081216,20081217,20081218,20081219,20081220,20081221,20081222,20081223,20081224,20081225,20081226,20081227,20081228,20081229,20081230,20090101,20090102,20090103,20090104,20090105,20090106,20090107,20090108,20090109,20090110,20090111,20090112,20090113,20090114,20090115,20090116,20090117,20090118,20090119,20090120,20090121,20090122,20090123,20090124,20090125,20090126,20090127,20090128,20090129,20090130,20090201,20090202,20090203,20090204,20090205,20090206,20090207,20090208,20090209,20090210,20090211,20090212,20090213,20090214,20090215,20090216,20090217,20090218,20090219,20090220,20090221,20090222,20090223,20090224,20090225,20090226,20090227,20090228,20090229,20090230,20091201,20091202,20091203,20091204,20091205,20091206,20091207,20091208,20091209,20091210,20091211,20091212,20091213,20091214,20091215,20091216,20091217,20091218,20091219,20091220,20091221,20091222,20091223,20091224,20091225,20091226,20091227,20091228,20091229,20091230,20100101,20100102,20100103,20100104,20100105,20100106,20100107,20100108,20100109,20100110,20100111,20100112,20100113,20100114,20100115,20100116,20100117,20100118,20100119,20100120,20100121,20100122,20100123,20100124,20100125,20100126,20100127,20100128,20100129,20100130,20100201,20100202,20100203,20100204,20100205,20100206,20100207,20100208,20100209,20100210,20100211,20100212,20100213,20100214,20100215,20100216,20100217,20100218,20100219,20100220,20100221,20100222,20100223,20100224,20100225,20100226,20100227,20100228,20100229,20100230,20101201,20101202,20101203,20101204,20101205,20101206,20101207,20101208,20101209,20101210,20101211,20101212,20101213,20101214,20101215,20101216,20101217,20101218,20101219,20101220,20101221,20101222,20101223,20101224,20101225,20101226,20101227,20101228,20101229,20101230,20110101,20110102,20110103,20110104,20110105,20110106,20110107,20110108,20110109,20110110,20110111,20110112,20110113,20110114,20110115,20110116,20110117,20110118,20110119,20110120,20110121,20110122,20110123,20110124,20110125,20110126,20110127,20110128,20110129,20110130,20110201,20110202,20110203,20110204,20110205,20110206,20110207,20110208,20110209,20110210,20110211,20110212,20110213,20110214,20110215,20110216,20110217,20110218,20110219,20110220,20110221,20110222,20110223,20110224,20110225,20110226,20110227,20110228,20110229,20110230,20111201,20111202,20111203,20111204,20111205,20111206,20111207,20111208,20111209,20111210,20111211,20111212,20111213,20111214,20111215,20111216,20111217,20111218,20111219,20111220,20111221,20111222,20111223,20111224,20111225,20111226,20111227,20111228,20111229,20111230,20120101,20120102,20120103,20120104,20120105,20120106,20120107,20120108,20120109,20120110,20120111,20120112,20120113,20120114,20120115,20120116,20120117,20120118,20120119,20120120,20120121,20120122,20120123,20120124,20120125,20120126,20120127,20120128,20120129,20120130,20120201,20120202,20120203,20120204,20120205,20120206,20120207,20120208,20120209,20120210,20120211,20120212,20120213,20120214,20120215,20120216,20120217,20120218,20120219,20120220,20120221,20120222,20120223,20120224,20120225,20120226,20120227,20120228,20120229,20120230,20121201,20121202,20121203,20121204,20121205,20121206,20121207,20121208,20121209,20121210,20121211,20121212,20121213,20121214,20121215,20121216,20121217,20121218,20121219,20121220,20121221,20121222,20121223,20121224,20121225,20121226,20121227,20121228,20121229,20121230,20130101,20130102,20130103,20130104,20130105,20130106,20130107,20130108,20130109,20130110,20130111,20130112,20130113,20130114,20130115,20130116,20130117,20130118,20130119,20130120,20130121,20130122,20130123,20130124,20130125,20130126,20130127,20130128,20130129,20130130,20130201,20130202,20130203,20130204,20130205,20130206,20130207,20130208,20130209,20130210,20130211,20130212,20130213,20130214,20130215,20130216,20130217,20130218,20130219,20130220,20130221,20130222,20130223,20130224,20130225,20130226,20130227,20130228,20130229,20130230,20131201,20131202,20131203,20131204,20131205,20131206,20131207,20131208,20131209,20131210,20131211,20131212,20131213,20131214,20131215,20131216,20131217,20131218,20131219,20131220,20131221,20131222,20131223,20131224,20131225,20131226,20131227,20131228,20131229,20131230'
#output_graphics <- args[5]
file_pca <- '/home/nils/data/EUCLEIA/output_pca-e49f2d78-8563-11e6-bf14-fbeae168c26e.txt'
file_Rdat <- '/home/nils/data//EUCLEIA/output_classification-e49f2d78-8563-11e6-bf14-fbeae168c26e.Rdat' #args[7]
#output_pca <- 
#output_Rdat <-
output_frec_percent <-'/home/nils/data//EUCLEIA/output_frequency.txt'
seas <- 'DJF'# args[11]
y1 <- 1970 #as.numeric(args[12])
y2 <- 1999 # as.numeric(args[13])
modelname <- ' HadGem' #args[14]

# Convert variables 
yr1 = as.numeric(y1)
yr2 = as.numeric(y2)
timeout  <- as.integer(unlist(strsplit(time,",")))

source(paste(Rsrc,"classnorm.R",sep=""))
source(paste(Rsrc,"libraryregimes.R",sep=""))

print(' Arguments functions loaded ')
print('Time from netCDF:')
print(timeout)

## load EOFs for thereference period 
load(file_Rdat)
EOF.r=read.table(file=file_pca)
n.eof=ncol(EOF.r)

# open prepared netCDF file for projection
nc = nc_open(infile)
data=ncvar_get(nc,varname)
lon=ncvar_get(nc,'lon')
lat=ncvar_get(nc,'lat')

# time=ncvar_get(nc,'time')
# print('Time from netCDF R:')
# print(time)

nx=dim(data)[2];ny=dim(data)[1]
nt=dim(data)[3]
# reshape order lat-lon-time
dat = data*NA; dim(dat) <- c(nt,ny,nx)
for (i in 1:nt) dat[i,,] <- t(as.matrix(data[,,i]))
# two dimentions
dim(dat)=c(nt,nx*ny)
nc_close(nc)
dat.m=dat
print( 'data sucessfully loaded' )

# #reproduce the time
# ical=366 
# 
# if(ical==366){
#   year=c()
#   month=c()
#   day=c()
#   monthdum=c(rep(1,31),rep(2,28),rep(3,31),rep(4,30),rep(5,31),rep(6,30),
#              rep(7,31),rep(8,31),rep(9,30),rep(10,31),rep(11,30),rep(12,31))
#   monthdumB=c(rep(1,31),rep(2,29),rep(3,31),rep(4,30),rep(5,31),rep(6,30),
#               rep(7,31),rep(8,31),rep(9,30),rep(10,31),rep(11,30),rep(12,31))
#   daydum=c((1:31),(1:28),(1:31),(1:30),(1:31),(1:30),(1:31),(1:31),(1:30),(1:31),(1:30),(1:31))
#   daydumB=c((1:31),(1:29),(1:31),(1:30),(1:31),(1:30),(1:31),(1:31),(1:30),(1:31),(1:30),(1:31))
#   yr=c(yr1:yr2)
#   bi=c(1:(yr2-yr1+1))
#   for(i in 1:(yr2-yr1+1)){
#     if ((yr[i]/4)==trunc(yr[i]/4)){
#       bi[i]=yr[i]
#       year=c(year,rep(yr[i],length=length(monthdumB)))
#       month=c(month,monthdumB)
#       day=c(day,daydumB)}
#     
#     else{
#       bi[i]=NaN
#       year=c(year,rep(yr[i],length=length(monthdum)))
#       month=c(month,monthdum)
#       day=c(day,daydum)}
#   }
#   month=array(month[1:(length(month))])
#   day=array(day[1:(length(day))])
#   year=array(year[1:(length(year))])
#   conv.time=list(month=month,day=day,year=year)
#   time=array((year)*10000+month*100+day)
# }
# if(ical==365){
#   year=c()
#   month=c()
#   day=c()
#   monthdum=c(rep(1,31),rep(2,28),rep(3,31),rep(4,30),rep(5,31),rep(6,30),
#              rep(7,31),rep(8,31),rep(9,30),rep(10,31),rep(11,30),rep(12,31))
#   daydum=c((1:31),(1:28),(1:31),(1:30),(1:31),(1:30),(1:31),(1:31),(1:30),(1:31),(1:30),(1:31))
#   yr=c(yr1:yr2)
#   for(i in 1:(yr2-yr1+1)){
#     year=c(year,rep(yr[i],length=length(monthdum)))
#       month=c(month,monthdum)
#       day=c(day,daydum)}
#   month=array(month[1:(length(month))])
#   day=array(day[1:(length(day))])
#   year=array(year[1:(length(year))])
#   conv.time=list(month=month,day=day,year=year)
#   time=array((year)*10000+month*100+day)
# }
# if (ical==360){
#   ndyear=360
#   nmyear=12
#   lmo=1:12
#   nyear=yr2-yr1+1
#   day=rep(1:30,times=nmyear*nyear)
#   month=rep(rep(lmo,each=30),times=nyear)
#   year=rep(y1:y2,each=ndyear)
#   conv.time=list(year=year,month=month,day=day)
#   time=array((year)*10000+month*100+day)
# }

#select season
# seas="JJA"

# l.seas=list(JJA=6:8,SON=9:11,MAM=3:5,DJF=c(12,1,2))
# ISEAS=which(conv.time$month %in% l.seas[[seas]] &
#               conv.time$year %in% c(yr1:yr2))
# time during the selected period and season
# timeout=time[ISEAS]

## Calculate projections for EOFs(PC empirics)
## Normalization by latitude
pond.slp=1/sqrt(cos(lat*pi/180))
scale.slp=rep(pond.slp,length(lon))
dat.scale=scale(dat.m,scale=scale.slp)
## Projection of EOFs (1970-2010)
print ('## Normalization by latitude')

print ('##### EOFs #######')
print ('##### EOFs #######')
print ('##### EOFs #######')
print (as.matrix(EOF.r))

print ('##### dat.scale #######')
print ('##### dat.scale #######')
print ('##### dat.scale #######')
print ('##### dat.scale #######')
print (dat.scale)

print ('###################')
print ('###################')
print ('###################')
print ('###################')

PC.e = dat.scale %*% as.matrix(EOF.r)


# compute distance, correlation and best WR
rms.reg=c()
cor.reg=c()
for(i in 1:nreg){
  diffi=t(t(PC.e) - dat.class$kmeans$centers[i,])
    diffi=diffi^2
    rms=apply(diffi,1,sum,na.rm=TRUE)
    dum=cor(t(dat.m),dat.class$reg.var[,i])
    rms.reg=cbind(rms.reg,rms)
    cor.reg=cbind(cor.reg,dum)
}

best.reg=apply(rms.reg,1,which.min)
dist.reg=sqrt(apply(rms.reg,1,min)/nrow(dat.m))

#Frequencies of Weather regimes for each "seas"
# timeout=time[ISEAS]

yyyy=floor(timeout/10000)
mm=floor(timeout/100) %% 100
yyyy[mm==12]=yyyy[mm==12]+1
uyyyy=sort(unique(yyyy))
yyyymm=yyyy*100+mm
dum=rep(1,length=length(yyyymm))
reg.freq=c()
reg.freq.total=c()
for(i in 1:nreg){
  tdum=tapply(dum[best.reg==i],yyyy[best.reg==i],length)
  ldum=tapply(dum,yyyy,length)
  rdum=rep(0,length=length(uyyyy))
  rdum[uyyyy %in% as.numeric(names(tdum))]=tdum
  rdum=rdum/ldum
  reg.freq=cbind(reg.freq,rdum)
  reg.freq.total[i]=(sum(reg.freq[,i])/length(uyyyy))*100
}

WR.freq <- as.data.frame(reg.freq*100)
WR.freq$year <- uyyyy

name.reg=c("Reg.1","Reg.2","Reg.3","Reg.4")
names(WR.freq) <- c(name.reg,"year")
total=nrow(WR.freq)+1
WR.freq[total,] <- c(reg.freq.total,"total")

## Save frequencies of Weather Regimes per seas in Results
write.table(file=output_frec_percent,WR.freq,quote=FALSE,row.names=FALSE)

## Saving the workspace 
save.image(file=output_Rdat) #lon,lat,time,

proc.time() - ptm

# print ('frequencies saved to file')
# ## Plotting Weather regimes of the model
# # fname=paste(Results,"projNCEP_regimes_",modelname,"_",yr1,"-",yr2,"_",seas,".pdf",sep="")
# pdf(file=output_graphics, height=8, width=11)
# layout(matrix(1:(2*ceiling(nreg/2)),2,ceiling(nreg/2)))
# for(i in 1:nreg){ 
#   champ=dat.class$reg.var[,i]/100                        
  
#   zlev=pretty(champ,20)
#   colplot=rainbow(length(zlev)-1,start=3/6,end=1)
#   par( mar=c(2.5,2,2,1.5))
  
#   dum=t(matrix(champ,length(lat),length(lon)))
#   #dum=matrix(champ,length(lon),length(lat)) #if transpose
#   lat.sort=sort(lat,index.return=TRUE)
#   titleplot=paste("NCEP(",y1,"-",y2,")",seas,"",name.reg[i],"(",
#                   format(dat.class$perc.r[i],digits=3),"%)")
  
#   contour(lon,sort(lat), dum[,lat.sort$ix],
#           xlab="Longitude",ylab="Latitude",main=titleplot,col=colplot,
#           add=FALSE,nlevels=length(zlev),
#           levels=zlev,lty=1, cex.main=0.95)
#   library(fields)
#   world(xlim=range(lon),ylim=range(lat),add=TRUE)
# }
# pdf(file='test.pdf')
# library(gridExtra)
# pdf("trade.pdf", height=11, width=8.5)
# library(grid)
# library(gridExtra)
# grid.newpage()
# grid.table(WR.freq)
# dev.off()

# proc.time() - ptm 






